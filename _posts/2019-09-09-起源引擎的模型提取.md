---
layout:     post
title:      起源引擎的模型提取
subtitle:   姿势
date:       2019-09-09
author:     秋梨家的居酒屋
header-img: img/optimization.png
catalog: true
tags:
    - 闲聊
---


在玩 Xnalara 的时候看到了几篇关于起源引擎导入 Xnalara 的教程，个人感觉写得非常详细，所以把其中一篇原帖被删的部分和没上传的部分保留到这里做个备份，步骤比较简单，而且文字描述很详细，所以没有上传图文，但原文档有全图片，所以附上下载链接。

可惜当初我入门时这篇文章还没面世，摸索了好久。

<br><br>

## 第三章 导入Blender (8楼补档)

可惜的是【起源引擎】的【.MDL】和【.VTF】，并不能直接导入3DMAX或Blender，我们得先将他们转换一下格式。

首先，下载.MDL转换工具【撬棍】，

地址：https://pan.baidu.com/s/1i5eKPQd （最新版本在steam社区发布，需要翻墙，有需要的同学可以 Google）
 
<br>
撬棍是起源引擎专用的反编辑软件，他能将.MDL转成【.SMD】，而这个格式可以3DMAX和BLENDER所导入
所以，让我们打开撬棍

在【MDL file】选择你要转换的文件夹其中一个.MDL，之后在【Full path】设置转换后的放置路径。
 
<br>
一切OK后点击【Decompile folder of MDL】（反编辑文件夹所有MDL），这样该文件夹所有的.MDL(内衣、脸、头发、装备)都将被转换

打开转换后的文件夹，删除所有子文件和后缀为.QC的文件，剩余的.smd就是模型本身。
 
这些模型里也包含着一些多余文件，比如同命名的模型里有四套.SMD，他们有些是战损，有些是低配模式的降质。我们只选择他们之中最大的，其余删除就可以了
 
<br><br>



### 3.1查找贴图

在转换.vtf之前，我们得先知道这个模型究竟使用了哪些.vtf。
通常.vtf贴图的命名跟.mdl模型一致，但总有些例外。
所以我们使用一个小工具MDLtextureInfo, 来应对这种状况
![enter description here](https://pic.superbed.cn/item/5d7651b3451253d1781ebb0c.jpg)
 
先随便选择一个.mdl，【右键】-然后点击【打开方式】

![enter description here](https://pic.superbed.cn/item/5d76520e451253d1781ec7b8.jpg)
 
点击【浏览】找到MDLtextureInfo的所在位置，之后在【始终使用选择的程序打开这种文件】前面打上勾。按【确定】保存 

![enter description here](https://pic.superbed.cn/item/5d765230451253d1781ecc96.jpg)
如此一来，当你双击任何.MDL，都将使用这个查看器打开。

<br>
那么，我们先随便双击一个.MDL
 
 ![enter description here](https://pic.superbed.cn/item/5d765239451253d1781ece12.jpg)

他会弹出一个窗口，在TEXTURE NAMES栏里所写的就是这个.MDL所使用的贴图名称。
 ![enter description here](https://pic.superbed.cn/item/5d76524b451253d1781ed129.jpg)

像刚才一样，把这个名称输入到搜索栏里（貌似不能复制），我们就能找到贴图了。

值得一提的是，虽然TEXTURE NAMES栏里写的是.vmt，但我们实际使用的是.vtf。所以只复制和.vmt同名的.vtf就好了

<br>

### 3.2 转换.vtf

用Vtfedit能实现.vtf贴图的批量转换
 
打开软件，点击【工具】——【批量转换】
 
设定好你的输入、输出文件夹，然后点击【转换为tga】——【开始转换】
 
这样格式就转好了。个人不建议把格式转换成.PNG，因为他不利于二次修改。
<br><br><br>
### 3.3 PS改色

之后点开你的输出文件夹，你会看到贴图呈一种【花花绿绿】的状态
 
别担心，这是正常现象，任何在洛奇英雄传出现的装备都是被染色过的，而这花花绿绿的贴图就是他被染色前的基本样式。

我一般在给模型上齐贴图之后再考虑贴图颜色，
 
这个顺序能比较直观的帮你分辨出哪个区域该换成什么
 
对比原设，绿色应该换成灰色、蓝色应该换成紫色、红色应该换成黄色

那么我们开启PS，随便打开一张【花花绿绿】的贴图
 
点击右下角的【通道】，你会看见其中包含三个通道【红、绿、蓝】，而这三种通道的颜色正好跟【花花绿绿】的贴图颜色相匹配。
 
其实游戏公司把贴图弄成【红、绿、蓝】的目的就是因为这个~
（关于红、绿、蓝通道和透明通道的概念你可以单独百度，不过你不了解也没关系，跟着我做就是了）

我们按住【CTRL】点击一个通道，比如【绿】通道，你会看到这个通道的范围以虚线画了出来
 
之后我们点击【图层】-【创建新图层】 

在新图层设置原图层为不可见（点击原图层前面的小眼睛），之后在右上角选择你想换成的颜色。
 
按【alt + delete】或 【shift + backspace】 填充前景色，之后按【ctrl + D】取消选区，这样一个图层就做好了~
 
做好一个图层后记得把这个图层的前面的小眼睛关闭，然后开启原图层的小眼睛。

之后我们就可以参照第一个图层的方法制作另外两个图层。


都完事后，我们最后再新建一个图层，然后直接填充黑色

 ![enter description here](https://pic.superbed.cn/item/5d765375451253d1781ef902.jpg)


把原图删除，之后开启【图层】、【通道】全部的小眼睛
 

然后点击【文件】——【储存为】，选择TGA格式，点击【保存】
 
按各种确定，图就被导出了。

剩下的贴图以此类推~虽然有点麻烦，但我觉得他比打出装备、攒钱买染色剂要简单多了。

<br><br>


### 3.4，用插件把模型导入Blender

Blender插件我已经在教程包里给出了（文章尾部），就是那个blender_source_tools_2.9.1

安装插件后，点击【导入】——【Source Engine（.smd.vta.dmx.qc）】
 
找到你放置.smd文件夹，把所有.smd模型文件一并选择，然后点击【import SMD/VTA.DMX.QC】
 

如果看到模型，那恭喜你导入成功
 
<br><br>


## 最终章，表情

这件事我应该一开始告诉大家，那就是你提取的模型没有面部骨骼…

那是因为洛英呈现表情的方式和XNALARA完全不同，洛英是用面部形态来呈现表情，而XNALARA则是用面部骨骼…

事实上我们玩上的洛英XNALARA模型都是前人一点点上的面部骨骼，而这个前人因为上骨骼太麻烦而出坑了…

所以我的教程选择了一种简单的方法~那就是利用【形态键】制作表情部件
 
<br>

我们用撬棍再次转换【.MDL】不过这次我们只转换FACE，也就是面部。

这次别删除QC或者子文件，我们将其全部保留
 
还是打开blender，点击【导入】——【Source Engine（.smd.vta.dmx.qc）】

只不过这次，我们导入.QC
 
<br>

导入之后，点击头部，然后点击我画框的小三角图标，找到【形态键】
 
随便点点那个【形态键】，你会看见黛莉娅会呈现出各种表情
 
<br>

选好你想用的表情后，点击减号下面的小三角，再点击【move to top】 

之后删除第一个形态键（选择第一个形态键，点减号），这时，你选择的表情会成为第一个形态键。
 
<br>

之后我们用xnalara插件导出。开启XPS导入这个部件
 
吓DIE…不过因为我只是做个演示而没有上贴图，上完后他的效果应该会好

你会发现，这个表情配件同样拥有身体骨骼，所以你把装备齐全的人物POSE导入到他身上，这个表情配件就会跟着你人物脸部重合，把原来的人物头部隐藏，于是就达成了更换表情的目的。

至此教程全部结束（~撒花）如有疑问，请在原贴回复我，我会尽量作答。


如果模型的选区有问题（比如你选择头盔，手臂也被选择上了）,那么开启blender导入模型，按【TAB】进入编辑模式，按住【L】键选择你想拆分部分。之后按【P】拆分就可了

我的方法是通过【任务图标】来得知他们的正确命名。
 
 
 原文件下载：	https://pan.baidu.com/s/1kUHGtFL <br>
 原帖地址：	https://tieba.baidu.com/p/5182352892
 
 （方法有很多种，但如果你是新手，可以先按作者的教程走）